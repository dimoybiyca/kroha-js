(()=>{"use strict";class t{constructor(t){this.inputs=t,this.initValues(t)}initValues(){this.line=this.inputs.map((t=>t.value))}getCodeBin(){return this.initValues(),this.line.slice(0,3).join("")}getCodeDec(){return this.toDec(this.getCodeBin())}getA1Bin(){return this.initValues(),this.line.slice(3,7).join("")}getA1Dec(){return this.toDec(this.getA1Bin())}setA1Bin(t){for(let e=3;e<7;e++)this.inputs[e].value=t[e-3]}setA1Dec(t){this.setA1Bin(this.toBin(t))}getA2Bin(){return this.initValues(),this.line.slice(7,11).join("")}getA2Dec(){return this.toDec(this.getA2Bin())}setA2Bin(t){for(let e=7;e<11;e++)this.inputs[e].value=t[e-7]}setA2Dec(t){this.setA2Bin(this.toBin(t))}getA3Bin(){return this.initValues(),this.line.slice(11,15).join("")}getA3Dec(){return this.toDec(this.getA3Bin())}setA3Bin(t){for(let e=11;e<15;e++)this.inputs[e].value=t[e-11]}setA3Dec(t){this.setA3Bin(this.toBin(t))}getValueBin(){return this.initValues(),this.line.join("")}getValueDec(){return this.toDec(this.getValueBin())}setValueBin(t){for(let e=0;e<15;e++)this.inputs[e].value=t.at(e)}setValueDec(t){this.setValueBin(this.toBin(t,15))}setValueCell(t){for(let e=0;e<15;e++)this.inputs[e].value=t.getValueBin().at(e)}toDec(t){return parseInt(t,2)}toBin(t,e=4){return t.toString(2).padStart(e,0)}}class e{ram=new Map;static getInstance(){return this.instance||(this.instance=new e),this.instance}constructor(t){this.initValues()}initValues(){this.inputs=document.getElementsByTagName("input"),this.initRAM()}initRAM(){for(let e=0;e<16;e++){const s=e.toString(2).padStart(4,"0"),i=15*e,n=new t(Array.prototype.slice.apply(this.inputs).slice(i,i+15));this.ram.set(s,n)}}getByAddr(t){return this.initRAM(),this.ram.get(t)}}class s{static getInstance(){return this.instance||(this.instance=new s),this.instance}constructor(){this.initValues()}initValues(){this.ram=e.getInstance(),this.mode=document.querySelectorAll(".mode-content"),this.cell=document.querySelectorAll(".cell-content"),this.decimal=document.querySelectorAll(".decimal-content"),this.instruction=document.querySelectorAll(".instruction-content"),this.addresses=document.querySelectorAll(".info__col-bin"),this.values=document.querySelectorAll(".info__col-dec"),this.status=document.querySelectorAll(".info__status")}updateUI(t,e){this.setCellContent(t),this.setDecimalContent(e),this.setAddressesContent(e),this.setInstructionContent(e)}setModeContent(t){this.mode.forEach((e=>e.textContent=t))}setCellContent(t){const e=t.toString(2).padStart(4,0);this.cell.forEach((t=>t.textContent=e))}setDecimalContent(t){const e=parseInt(t.join(""),2);this.decimal.forEach((t=>t.textContent=e))}setAddressesContent(t){for(let e=0;e<3;e++){const s=3+4*e,i=t.slice(s,s+4).join("");this.addresses[e].textContent=i,this.values[e].textContent=this.ram.getByAddr(i).getValueDec()}}setInstructionContent(t){const e=parseInt(t.slice(0,3).join(""),2);this.instruction.forEach((t=>t.textContent=i[e]))}setStatusContent(t){this.status.forEach((e=>e.textContent=t))}}const i={0:"A1 ==> A3",1:"A1 + A2 ==> A3",2:"A1 / A2 ==> A3",3:"|A1-A2| ==> A3",4:"if A1 = A2 goto A3",5:"A1 * A2 ==> A3",6:"if A1 > A2 goto A3",7:"HALT, OUTPUT"};class n{static getInstance(){return this.instance||(this.instance=new n),this.instance}constructor(){this.initValues(),this.updateUI()}initValues(){this.focus=0,this.inputs=document.getElementsByTagName("input"),this.addresses=document.querySelectorAll(".table__elem-adr"),this.info=s.getInstance(),this.setFocus()}process(t){switch(t){case"ArrowRight":case"6":this.increaseFocus();break;case"ArrowLeft":case"4":this.decreaseFocus();break;case"ArrowUp":case"2":this.decreaseFocus(15);break;case"ArrowDown":case"8":this.increaseFocus(15);break;case"1":this.setNumberContent(1);break;case"0":case"Backspace":this.setNumberContent(0)}this.updateUI()}increaseFocus(t=1){this.focus=(this.focus+t)%this.inputs.length,this.setFocus()}decreaseFocus(t=1){t<=this.focus?this.focus=this.focus-t:this.focus=this.focus+this.inputs.length-t,this.setFocus()}setFocus(){this.inputs[this.focus].focus({preventScroll:!0}),this.inputs[this.focus].setSelectionRange(1,1)}setNumberContent(t){this.inputs[this.focus].value=t,this.increaseFocus(1)}setFocusVal(t,e=!0){this.focus=t,this.setFocus(),this.updateUI(),e&&this.addHighlight(t)}removeHighlight(){for(let t of this.addresses)t.classList.contains("active-adr")&&t.classList.remove("active-adr")}addHighlight(t){this.removeHighlight(),this.addresses[t/15].classList.add("active-adr")}updateUI(){const t=Math.trunc(this.focus/15),e=15*t,s=Array.prototype.slice.apply(this.inputs).slice(e,e+15).map((t=>t.value));this.info.updateUI(t,s)}}class a{constructor(t){this.elements=t,this.initValues()}initValues(){this.ram=e.getInstance()}getCodeBin(){return this.elements[0].textContent}getCodeDec(){return this.toDec(this.elements[0].textContent)}getA1Bin(){return this.elements[1].textContent}getA1Dec(){return this.toDec(this.elements[1].textContent)}getA2Bin(){return this.elements[2].textContent}getA2Dec(){return this.toDec(this.elements[2].textContent)}getA3Bin(){return this.elements[3].textContent}getA3Dec(){return this.toDec(this.elements[3].textContent)}getValueBin(){return Array.from(this.elements).map((t=>t.textContent)).join("")}getValueDec(){return this.toDec(this.getValueBin())}setValueBin(t){this.elements[0].textContent=t.slice(0,3);for(let e=1;e<this.elements.length;e++){const s=4,i=4*e-1;this.elements[e].textContent=t.slice(i,i+s)}}setValueDec(t){const e=this.toBin(t,15);this.setValueBin(e)}setValueCell(t){this.setValueBin(t.getValueBin())}resetValues(){for(let t=0;t<4;t++)this.elements[t].textContent=this.toBin(0,0===t?3:4)}toDec(t){return parseInt(t,2)}toBin(t,e=4){return t.toString(2).padStart(e,0)}}class r{static getInstance(){return this.instance||(this.instance=new r),this.instance}constructor(){this.initValues()}initValues(){this.pcElement=document.querySelector("#pc"),this.irElements=document.querySelectorAll("#rc"),this.acElements=document.querySelectorAll("#ad"),this.ram=e.getInstance(),this.ir=new a(this.irElements),this.ac=new a(this.acElements)}getPCBin(){return this.pcElement.textContent}getPCDec(){return parseInt(this.getPCBin(),2)}setPCBin(t){this.pcElement.textContent=t}setPCDec(t){this.setPCBin(t.toString(2).padStart(4,0))}incPC(){let t=this.getPCDec()+1;16===t&&(t=0),this.setPCDec(t)}getIR(){return this.ir}initIR(){this.ir.setValueBin(this.ram.getByAddr(this.getPCBin()).getValueBin())}getAC(){return this.ac}initAC(){this.ac.setValueCell(this.ram.getByAddr(this.ir.getA1Bin()))}reset(){this.ac.resetValues(),this.ir.resetValues(),this.setPCDec(0)}}class c{static getInstance(){return this.instance||(this.instance=new c),this.instance}constructor(){this.initValues()}initValues(){this.outputs=document.querySelectorAll(".screenB"),this.decimal=document.querySelectorAll(".screenDec")}printValues(t,e){this.outputs[4*t].textContent=e.getCodeBin(),this.outputs[1+4*t].textContent=e.getA1Bin(),this.outputs[2+4*t].textContent=e.getA2Bin(),this.outputs[3+4*t].textContent=e.getA3Bin(),this.decimal[t].textContent=e.getValueDec()}resetScreen(){for(let t=0;t<12;t++)this.outputs[t].textContent="0".padStart(t%4==0?3:4,0);for(let t=0;t<3;t++)this.decimal[t].textContent=0}}class o{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<5;t++)this.executeStep(t)}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:return this.ram.getByAddr(this.alu.getIR().getA3Bin()).setValueBin(this.alu.getAC().getValueBin()),0}this.step++}printStatus(){this.info.setStatusContent(u[this.step])}}const u={1:"Read instruction at the address from the PC to RC",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Write from the AC into cell for address A3"};class h{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<6;t++)this.executeStep()}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:let t=this.alu.getAC().getValueDec();t+=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec(),this.alu.getAC().setValueDec(t);break;case 5:return this.ram.getByAddr(this.alu.getIR().getA3Bin()).setValueDec(this.alu.getAC().getValueDec()),0}this.step++}printStatus(){this.info.setStatusContent(l[this.step])}}const l={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Write AC + number in cell for the address A2 into AC",5:"Write from the AC into cell for address A3"};class d{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<5;t++)this.executeStep(t)}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:let t=this.alu.getAC().getValueDec();t/=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec(),this.alu.getAC().setValueDec(t);break;case 5:return this.ram.getByAddr(this.alu.getIR().getA3Bin()).setValueDec(this.alu.getAC().getValueDec()),0}this.step++}printStatus(){this.info.setStatusContent(g[this.step])}}const g={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Write AC / number in cell for the address A2 into AC",5:"Write from the AC into cell for address A3"};class A{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<5;t++)this.executeStep(t)}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:let t=this.alu.getAC().getValueDec();t-=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec(),this.alu.getAC().setValueDec(Math.abs(t));break;case 5:return this.ram.getByAddr(this.alu.getIR().getA3Bin()).setValueDec(this.alu.getAC().getValueDec()),0}this.step++}printStatus(){this.info.setStatusContent(p[this.step])}}const p={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Write AC - number in cell for the address A2 into AC",5:"Write from the AC into cell for address A3"};class C{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<5;t++)this.executeStep(t)}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:let t=this.alu.getAC().getValueDec();t*=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec(),this.alu.getAC().setValueDec(Math.trunc(t));break;case 5:return this.ram.getByAddr(this.alu.getIR().getA3Bin()).setValueDec(this.alu.getAC().getValueDec()),0}this.step++}printStatus(){this.info.setStatusContent(m[this.step])}}const m={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Write AC * number in cell for the address A2 into AC",5:"Write from the AC into cell for address A3"};class f{constructor(){this.initValues()}initValues(){this.step=1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance(),this.screen=c.getInstance()}execute(){for(let t=1;t<7;t++)this.executeStep(t);return-1}executeStep(){switch(this.printStatus(this.step),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.printValue(1,this.alu.getIR().getA1Bin());break;case 4:this.printValue(2,this.alu.getIR().getA2Bin());break;case 5:this.printValue(3,this.alu.getIR().getA3Bin());break;case 6:return-1}this.step++}printValue(t,e){this.screen.printValues(t-1,this.ram.getByAddr(e))}printStatus(t){this.info.setStatusContent(I[t])}}const I={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Output first number on screen",4:"Output second number on screen",5:"Output third number on screen",6:"HALT"};class V{constructor(){this.initValues()}initValues(){this.step=1,this.condition=!1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<6;t++)this.executeStep()}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:const t=this.alu.getAC().getValueDec(),e=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec();this.condition=t===e;break;case 5:return this.condition&&this.alu.setPCBin(this.alu.getIR().getA3Bin()),0}this.step++}printStatus(){this.condition?this.info.setStatusContent(B[6]):this.info.setStatusContent(B[this.step])}}const B={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Compare AC with value in cell by address A3",5:"Condition is not fulfilled, transition does not occur",6:"Condition complete, perform transition"};class S{constructor(){this.initValues()}initValues(){this.step=1,this.condition=!1,this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance()}execute(){for(let t=1;t<6;t++)this.executeStep()}executeStep(){switch(this.printStatus(),this.step){case 1:this.alu.initIR();break;case 2:this.alu.incPC();break;case 3:this.alu.initAC();break;case 4:const t=this.alu.getAC().getValueDec(),e=this.ram.getByAddr(this.alu.getIR().getA2Bin()).getValueDec();this.condition=t>e;break;case 5:return this.condition&&this.alu.setPCBin(this.alu.getIR().getA3Bin()),0}this.step++}printStatus(){this.condition?this.info.setStatusContent(b[6]):this.info.setStatusContent(b[this.step])}}const b={1:"Read instruction at the address from the PC to IR",2:"Increase PC by 1 (Prepare to execute the next instruction)",3:"Number for the address A1 into AC",4:"Compare AC with value in cell by address A3",5:"Condition is not fulfilled, transition does not occur",6:"Condition complete, perform transition"};class x{static getInstruction(t){switch(t){case"000":return new o;case"001":return new h;case"010":return new d;case"100":return new V;case"011":return new A;case"101":return new C;case"110":return new S;default:return new f}}}new class{constructor(t,e,s){this.codeLen=t,this.addrLen=e,this.ramSize=s,this.initValues()}initValues(){this.rowLen=this.codeLen+3*this.addrLen,this.container=document.querySelector(".table")}buildComputer(){for(let t=0;t<this.ramSize;t++){this.insertColumn(t);for(let e=0;e<this.rowLen;e++)this.insertRow(t,e)}}insertColumn(t){const e=t.toString(2).padStart(4,0);this.container.insertAdjacentHTML("beforeend",`<tr class="table__row" id="${"r"+t}">\n        <td class="table__elem-adr">${e}</td>\n      </tr>`)}insertRow(t,e){document.querySelector("#r"+t).insertAdjacentHTML("beforeend",`<td class="table__elem-mem">\n        <input\n          type="text"\n          inputmode="numeric"\n          pattern="[0-1]"\n          value="0"\n          maxlength="1"\n          id="${"i"+(t*this.rowLen+e)}"\n        />\n      </td>`)}}(3,4,16).buildComputer();const D=document.getElementsByTagName("input"),y=new class{constructor(t){this.inputs=t,this.initValues()}initValues(){this.ram=e.getInstance(),this.alu=r.getInstance(),this.info=s.getInstance(),this.control=n.getInstance(),this.screen=c.getInstance(),this.instruction=null,this.isHalted=!1}getControl(){return this.control}auto(){let t=0;if(this.isHalted)this.reset();else{for(;!this.isHalted;){if(!(t<5e3)){this.reset(),this.info.setStatusContent("ERROR Infinite loop");break}this.executeInstruction(),t++}this.info.setModeContent("Auto")}}step(){this.info.setModeContent("Step"),this.isHalted?this.reset():this.executeInstruction()}tact(){if(this.info.setModeContent("Tact"),this.isHalted)return void this.reset();this.selectInstruction();const t=this.instruction.executeStep();this.processResult(t),this.control.updateUI()}processResult(t){0===t?this.instruction=null:-1===t&&(this.instruction=null,this.isHalted=!0,this.control.removeHighlight())}selectInstruction(){if(!this.instruction){this.control.setFocusVal(15*this.alu.getPCDec());const t=this.ram.getByAddr(this.alu.getPCBin()).getCodeBin();this.instruction=x.getInstruction(t)}}executeInstruction(){this.selectInstruction(),-1===this.instruction.execute()&&this.processResult(-1),this.instruction=null,this.control.updateUI()}reset(){this.instruction=null,this.isHalted=!1,this.info.setModeContent("Editor"),this.info.setStatusContent(""),this.control.removeHighlight(),this.alu.reset(),this.screen.resetScreen()}},R=y.getControl();document.addEventListener("keydown",(t=>{switch(t.preventDefault(),R.process(t.key),t.key.toUpperCase()){case"A":console.log("A"),y.auto();break;case"S":y.step();break;case"T":y.tact();break;case"E":case"1":case"0":case"BACKSPACE":y.reset()}}));for(let t of D)t.addEventListener("click",(function(){R.setFocusVal(parseInt(this.id.slice(1)),!1)}));document.querySelectorAll(".btn-auto").forEach((t=>t.addEventListener("click",(()=>y.auto())))),document.querySelectorAll(".btn-step").forEach((t=>t.addEventListener("click",(()=>y.step())))),document.querySelectorAll(".btn-tact").forEach((t=>t.addEventListener("click",(()=>y.tact()))))})(),(()=>{const t=document.getElementById("burger-menu"),e=document.querySelector(".header__nav");t.addEventListener("click",(function(t){t.preventDefault(),this.classList.toggle("close"),e.classList.toggle("overlay")}))})();